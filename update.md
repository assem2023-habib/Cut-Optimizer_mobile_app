دليل الانتقال التقني إلى Flutter: منطق النمط المزدوج (فردي/زوجي)
هذا المستند مخصص لمطور Flutter لنقل التحديثات الأخيرة الخاصة بـ "نمط الزوجي" (Pair Mode) من نسخة Python إلى النسخة الجديدة.

1. منطق الإعدادات (Settings Logic)
   تم نقل خيار "فردي/زوجي" ليكون جزءاً من كل ماكينة بدلاً من خيار عام.

التعديل في UI:
النمط B (فردي): يتم التعامل مع السجادة كقطعة واحدة.
النمط A (زوجي): يتم طي السجادة أو تشغيل طبقتين، مما يعني أن الماكينة "تنتج" ضعف ما "تقصه".
البيانات المخزنة:
يجب أن يحتوي كائن
MachineSize
على حقل pair_mode بقيمة "A" أو "B".

class MachineSize {
String name;
int minWidth;
int maxWidth;
String pairMode; // "B" for Odd, "A" for Even
// ... بقية الحقول
} 2. استيراد البيانات (Data Import Logic)
عند قراءة ملف Excel، يتم تعديل "الكمية" (Quantity) بناءً على النمط المحدد للماكينة المختارة قبل دخولها إلى خوارزمية التجميع.

العملية الحسابية:
إذا كان النمط هو A (زوجي)، يتم تقسيم الكمية الأصلية على 2 (قسمة صحيحة مع جبر الكسر للأعلى لضمان قطعة واحدة على الأقل).

Python Logic:

if pair_mode == "A":
qty = max(1, qty_raw // 2) # القسمة على 2
else:
qty = qty_raw # النمط الفردي يبقى كما هو
السبب: الخوارزمية تجمع القطع بناءً على "عدد المرات التي ستعمل فيها الماكينة". في النمط الزوجي، كل "قصة" تنتج قطعتين فعلياً.

3. خوارزمية التجميع (Grouping Algorithm)
   لا تتغير الخوارزمية نفسها كثيراً، لكنها تعمل على "الكميات المعدلة".

إذا كانت الطلبية 10 قطع ونحن في النمط A، الخوارزمية ترى 5 قطع فقط.
هي ستحاول تجميع الـ 5 قطع في "قصص" (Groups) بناءً على العرض والطول. 4. تقارير Excel (Reporting & Formulas)
هذا هو الجزء الأهم، حيث يجب إعادة "ضرب" النتائج في 2 في النمط الزوجي لإظهار الأرقام الحقيقية للعميل.

المفهوم الأساسي: Multiplier
إذا كان النمط A: multiplier = 2
إذا كان النمط B: multiplier = 1
تفاصيل كل ورقة (Sheet):
أ. ورقة الإجماليات (Totals Sheet)
كمية الطلبية: تبقى كما هي في الأصل (قبل التقسيم).
الكمية المتبقية: (الكمية التي لم تجمعها الخوارزمية) × multiplier.
الكمية المنتجة: (الطلبية الأصلية - الكمية المتبقية المحسوبة أعلاه).
كمية الهادر: (مساحة الفراغات في القصص) × multiplier.
ب. ورقة التدقيق (Audit Sheet)
لمطابقة الكميات مع ملف الإدخال:

Used Qty = (العدد الذي استخدمته الخوارزمية) × multiplier.
Remaining Qty = (العدد المتبقي) × multiplier.
Difference = (Used + Remaining) - Original. (يجب أن يكون 0 دائماً).
ج. تفاصيل القصات (Group Details)
الكمية المستخدمة: (العدد في المسار) × multiplier.
الكمية المتبقية: (المتبقي من هذا النوع) × multiplier.
ملاحظة: "طول المسار" لا يضرب في 2 لأنه يعبر عن المسافة الفيزيائية التي ستمشيها الماكينة.
د. ورقة الهادر (Waste Sheet)
الهادر في العرض: (العرض المتبقي من الماكينة × طول القصة) × multiplier.
هادر المسارات: (فروقات الأطوال داخل القصة) × multiplier.
نسبة الهدر: (إجمالي الهادر المحسوب أعلاه × 100) / (إجمالي مساحة السجاد الأصلي × multiplier). 5. ملخص العمليات الحسابية لكل ورقة
الحقل المعادلة
Import Quantity finalQty = (mode == A) ? max(1, originalQty ~/ 2) : originalQty
Report Quantity reportQty = algoQty _ multiplier
Area Waste absoluteWaste = runWaste _ multiplier
Total Produced TotalOrder - (RemainingAlgo \* multiplier) 6. نصائح لمطور Flutter
Model Update: تأكد من إضافة pair_mode لموديل
Carpet
أو مرره كبارامتر لخدمة معالجة البيانات.
State Management: عند تغيير الماكينة في القائمة المنسدلة، يجب تحديث حالة pair_mode فوراً ليتم استخدامها في الحسابات اللاحقة.
Excel Library: استخدم مكتبة مثل
excel
في Flutter، وقم بتطبيق الضرب في multiplier عند كتابة الخلايا الخاصة بالكميات والمساحات.
IMPORTANT

النمط A (Even) هو المسؤول الوحيد عن تفعيل الضرب والقسمة على 2. في النمط B (Odd)، يكون الـ multiplier دائماً 1 والعمليات الحسابية طبيعية.
